(function(h){var b=0,d={},a={store:"session"},g=250,e={s:"Einzelzimmer",d:"Doppelzimmer",t:"Zweibettzimmer",m:"Mehrbettzimmer"},f={sc:"Ohne Verpflegung",br:"Fr&uuml;hst&uuml;ck",hb:"Halbpension",fb:"Vollpension"},c={s:16,d:32,t:64,m:128,sc:1,br:2,hb:4,fb:8};MemBox={max:15,init:function(m,p){this.entries=Util.retrieve("mb_all",d)||{};this.popped={};this.container=("string"==typeof m)?h("#"+m):m;if(!this.push(p)){this.current=0}this.container.on("click",".close",function(){MemBox.pop(h(this).parent()[0].id.match(/^mb-(\d+)$/)[1])});var n=this,l=function(){var r=h(this),q=h();if(r.is(".course-cost td")){q=r.prev()}else{if(r.is(".course-cost th")){q=r.next()}else{if(r.is(".services tr")){q=r.children()}}}r.add(q).toggleClass("hover")},o=function(){h(window).scroll()},k=h(window).height(),j=h(window).width();h(document).bind("school_loaded",function(r,q){n.push(q,true)}).bind("ajax_change_state",function(q,r){if("school"==r.object){n.push(r.id)}else{n.current=0}}).one("util_init_done",function(){for(var q in n.entries){n.show();break}});RqApp.init()},push:function(l,m){var n=l.id||l,j=this;if(!l||"object"==typeof n){return false}if(j.entries[n]){if("object"==typeof l){for(k in l){if(!(k in j.entries[n])||j.entries[n][k]!==l[k]){j.entries[n][k]=l[k]}}for(var k in j.entries[n]){if(!(k in l)){delete j.entries[n][k]}}}return m||j.visit(n)}if(j.popped[n]){l=j.popped[n];delete j.popped[n]}if("object"==typeof l){delete l.id;j.entries[n]=l}j.entries[n].t=new Date().getTime();m||(j.current=n);j.repaint();Util.store("mb_all",j.entries,d);if(!b){j.show()}return true},pop:function(j){if(!this.entries[j]){return false}h("#mb-"+j,this.container).remove();this.popped[j]=this.entries[j];delete this.entries[j];for(i in this.entries){Util.store("mb_all",this.entries,d);return true}Util.store("mb_all",null,d);b=0;this.container.slideUp(g);return true},visit:function(j){if(!this.entries[j]){return false}this.current=j;this.entries[j].t=new Date().getTime();Util.store("mb_all",this.entries,d);this.repaint();return true},show:function(){b=1;this.repaint();this.container.show()},repaint:function(){var q,o,m,l=this,r=l.getSortedIds(),p,s;s=Math.min(r.length,l.max);p=l.container.children("#mb").hide().empty();for(q=0;q<s;q++){l.addCrumb(r[q],!!q)}p.show();if(r.length>l.max){for(q=l.max;q<r.length;q++){delete l.entries[r[q]]}Util.store("mb_all",l.entries,d)}},getSortedIds:function(){var k,l=[],j=this;for(k in j.entries){l[l.length]=k}l.sort(function(n,m){return j.entries[m].t-j.entries[n].t});return l},addCrumb:function(n,j){if(!this.entries[n]){return}var m=this.entries[n],l=h('<li id="mb-'+n+'" class="c-'+m.url.match(/^\/([^\/]*)/)[1]+'" />'),k=h("#mb",this.container);l.append('<a href="'+m.url+'" data-title="'+m.lbl+'"><h2>'+m.lbl+"</h2></a>");h('<div class="close" title="Aus der Liste l&ouml;schen" />').prependTo(l);if(j){k.append(l)}else{k.prepend(l)}return l},getCurrent:function(){return this.get(this.current)},get:function(j){if(j in this.entries){return this.entries[j]}else{if(j in this.popped){return this.popped[j]}else{return false}}}};RqApp={stage:0,elem:h('<form id="rq" />'),init:function(){var m=this,l=h(window).height(),k=h(window).width(),j=function(){m.stage&&m.position(false)};h(document).bind({ajax_switchto:j,foldout_done:j,ajax_change_state:function(n,o){if("school"==o.object||m.u&&/^quote(\?|$)/.test(o.id)&&"page"==o.object){m.resetData();m.setStage(m.u?10:1)}else{m.setStage(0)}},foldout:function(n,o){if(2==m.stage||12==m.stage){if(/^a-/.test(o)){m.elem.find('[name="acc"]').val(o).change()}else{if(/^c-/.test(o)){m.elem.find('[name="course"]').val(o).change()}}}},util_init_done:function(){var n;if("quote"==Ajax.state.id&&"page"==Ajax.state.object){n=location.href.match(/([^\/]+)\?u=(\d+)&q=([a-z0-9]+).*/);Ajax.replaceState({cat:0,object:"page",id:n[0]},{cat:0,object:"page",id:n[1]});Util.store("quote-user",n,a)}else{n=Util.retrieve("quote-user",a)}if(n){m.u=n[2];m.q=n[3];m.setStage(10);h("#request-link").attr("href","/"+n[0]).html("Ihre Kostenvoranschl&auml;ge")}}});h(window).scroll(j).resize(function(){if(m.stage){if(navigator.userAgent&&/MSIE/.test(navigator.userAgent)){var p=h(window),n=p.height(),o=p.width();if(n==l&&o==k){return}l=n;k=o}m.position(false)}});h(document.body).on("change","#rq :input",function(){m.data||(m.data={});if(this.type=="checkbox"){if(/\[]/.test(this.name)){(m.data[this.name]||(m.data[this.name]={}))[this.value]=this.checked}else{m.data[this.name]=this.checked}}else{m.data[this.name]=this.value}var p,o,n;if("acc"==this.name){o=h(this).closest("form").find('select[name="room"],select[name="board"]');if(this.value&&(p=parseInt(MemBox.get(m.data.school)[this.value].split("\t")[1],16))){o.prop("disabled",false).children().each(function(){this.disabled=!(c[this.value]&p)});o.each(function(){if(!(c[this.value]&p)){h(this).val(h(this).children().not("[disabled]").first().val()).change()}})}else{o.prop("disabled",true)}}else{if("course"==this.name){o=h(this).closest("form").find('select[name="duration"]').empty();p=MemBox.get(m.data.school)[this.value].split("\t");for(n=parseInt(p[2]);n<=p[3];n++){if(!p[4].match(","+n+",")){o.append('<option value="'+n+'">'+(n+1)+("s"==p[1]?" Semester":(" Woche"+(n?"n":"")))+"</option>")}}m.data.duration=o.val(m.data.duration).val()}}}).on("click","#rq.stage-1, #rq.stage-10",function(){var n=1;if(10==m.stage&&MemBox.current){m.data.school=MemBox.current;n=2}m.setStage(m.stage+n)}).on("click","#rq-back",function(){if(m.stage==11&&!("quote"==Ajax.state.id&&"page"==Ajax.state.object||"school"==Ajax.state.object)){m.setStage(0)}else{m.setStage(m.stage-1)}}).on("submit","#rq",function(){var o,n=function(p,q){if("success"==q){m.setStage(m.stage+1,p.responseText)}else{m.elem.find(":input").prop("disabled",false).filter("#rq-next").val("Erneut senden").end().filter('[name="acc"]').change();m.elem.children("nav").prepend('<div class="ybox">Beim Versenden des Formulars ist ein Fehler aufgetreten. Sollte sich dies wiederholen, bitte melden Sie uns den Vorfall.</div>');m.position(true)}};if(2==m.stage||11==m.stage||3==m.stage&&fbk.noAutoQ){m.setStage(m.stage+1)}else{if(3==m.stage&&!fbk.noAutoQ||4==m.stage&&fbk.noAutoQ||12==m.stage){m.elem.find(":input[required]").each(function(){if(!this.value||"email"==this.type&&!/.+@.+\..+/.test(this.value)){h(this).addClass("invalid").focus();o=true;return false}});if(!o){h.ajax({type:"POST",data:"action="+(12==m.stage?"fbk_add_quote":"fbk_request")+"&school="+m.data.school+(m.u?"&u="+m.u+"&q="+m.q:"")+"&"+m.elem.serialize(),complete:n});m.elem.find(":input").change().prop("disabled",true).filter("#rq-next").val("Wird gesendet...")}}}return false}).on("click","#page",function(n){if(!h(n.target).closest("#rq").length&&!h(n.target).closest(".single-school #content").length){if(m.stage>1&&(m.stage<4&&!fbk.noAutoQ||m.stage<5&&fbk.noAutoQ)){m.setStage(1)}else{if(m.stage>10){m.setStage(10)}}}}).on("click",".open-push-quote",function(){h("#push-quote").insertAfter(h(this).closest(".quote-pick").hide()).show().find('input[name="birthdate"]').removeClass("hasDatepicker").datepicker()}).on("click","#push-quote .cancel",function(){h("#push-quote").hide().siblings(".quote-pick").show()}).on("submit","#push-quote",function(){var n=h(this);h.ajax({method:"POST",data:"action=fbk_push_quote&quote="+n.closest("section.quote").attr("id").match(/quote-(.*)/)[1]+"&u="+m.u+"&q="+m.q+"&"+n.serialize(),complete:function(o,p){if("success"==p){n.hide().after(o.responseText).find('[type="submit"]').val("Absenden Â»")}else{n.prepend('<p class="ybox">Beim Versenden des Formulars ist ein Fehler aufgetreten. Sollte sich dies wiederholen, bitte melden Sie uns den Vorfall.</p>').find('[type="submit"]').val("Erneut senden")}n.find(":input").prop("disabled",false)}});n.find(":input").prop("disabled",true).filter('[type="submit"]').val("Wird gesendet...");return false});h("#request-link").click(function(n){if(m.u){return true}if(1==m.stage||10==m.stage){var o=1;if(10==m.stage&&MemBox.current){m.data.school=MemBox.current;o=2}m.setStage(m.stage+o);n.stopPropagation();return false}})},setStage:function(n,z){var p,o,m,y,w,t,v,s,q,u=h(),x=RqApp;x.elem.detach().removeClass();switch(n){default:n=0;break;case 1:case 10:x.elem.html(10==n?"Einen weiteren Kostenvoranschlag hinzuf&uuml;gen &raquo;":"Unverbindlicher Kostenvoranschlag &raquo;");x.position();break;case 11:m=x.elem.empty().append('<div id="stage-11"><label for="stage-11">Schule: </label> <select name="school" id="stage-11" /><p class="ybox">Sehen Sie sich auf unserer Seite um, um weitere Schulen ausw&auml;hlen zu k&ouml;nnen!</p><nav><input type="button" id="rq-back" value="Abbrechen" tabindex="3"><input type="submit" id="rq-next" value="Weiter &raquo;" tabindex="2"></nav></div>').find("select");o=MemBox.getSortedIds();for(p=0;p<o.length;p++){m.append('<option value="'+o[p]+'">'+MemBox.get(o[p]).lbl+"</option>")}if(x.data&&x.data.school){m.val(x.data.school)}else{u=m}break;case 12:case 2:if(1==x.stage||11==x.stage){x.data||(x.data={});x.data.course=h(".slice-kurse").find(".foldout-outer").not(".collapsed").parent().attr("id");x.data.acc=h(".slice-unterkunft").find(".foldout-outer").not(".collapsed").parent().attr("id")}if(12==n||!x.elem.find("#stage-2").length){w=MemBox.get(x.data.school);y=x.elem.empty().append('<div><table id="stage-2"><tbody /></table></div>').find("tbody");q="";t=h('<select name="course" />');v=h('<select name="acc"><option value="">Keine Unterkunft</option></select>');s=h('<td style="white-space:nowrap;"><div>Beginn: <input name="start"></div><div>Dauer: <select name="duration"><option>1 Semester</option></select></div></td>');for(p in w){if(/^c-/.test(p)){t.append('<option value="'+p+'">'+w[p].split("\t")[0])}else{if(/^a-/.test(p)){v.append('<option value="'+p+'">'+w[p].split("\t")[0])}else{if(/^f-/.test(p)){fee=w[p].split("\t");q+='<li><input type="checkbox" name="fees[]" value="'+p+'" id="cb-'+p+'"> <label for="cb-'+p+'">'+fee[0]+(fee[1]?" ("+fee[1]+")":"")+"</label></li>"}}}}v=h('<td><select name="room"><option value="s">Einzelzimmer<option value="d">Doppelzimmer<option value="t">Zweibettzimmer</option><option value="m">Mehrbettzimmer</select><select name="board"><option value="sc">Ohne Verpflegung<option value="br">Fr&uuml;hst&uuml;ck<option value="hb">Halbpension<option value="fb">Vollpension</select>').prepend(v);y.append("<tr><th>Kurs</th><th>Zeitraum</th><th>Unterkunft</th></tr>").append(h("<tr />").append(h("<td />").append(t)).append(s).append(v));if(q){v.children().not(":last-child").after("<br>");y.children().first().append("<th>Weitere Leistungen</th>").siblings().append("<td><ul>"+q+"</ul></td>")}u=v.children('select[name="acc"]').add(t);y.find(":input").attr("tabindex",1).filter('[name="start"]').datepicker({minDate:"+1",beforeShowDay:function(j){return[j.getDay()==1,"",""]},beforeShow:function(j){setTimeout(function(){var k=(j=h(j)).datepicker("widget");k.css("top",j.offset().top-k.innerHeight()-h(window).scrollTop()-2+"px")},50)}})}x.elem.children("h2,nav").remove();x.elem.prepend("<h2>Kostenvoranschlag &ndash; &Uuml;ber welches Programm wollen Sie mehr wissen?</h2>").append('<nav><input type="button" id="rq-back" value="Abbrechen" tabindex="3"><input type="submit" id="rq-next" value="'+(12==n?"Hinzuf&uuml;gen":"Weiter")+' &raquo;" tabindex="2"></nav>');x.elem.find("#stage-3 :input").prop("disabled",true);break;case 3:if(!x.elem.find("#stage-3").length){x.elem.append('<div><table id="stage-3"><tbody><tr><th>Anrede</th><td><select name="salutation"><option>Frau<option>Herr</select></td><th>Stra&szlig;e</th><td><input name="street"></td></tr><tr><th>Vorname</th><td><input required name="first_name"></td><th>PLZ</th><td><input name="postalcode"></td></tr><tr><th>Nachname</th><td><input required name="last_name"></td><th>Ort</th><td><input name="city"></td></tr><tr><th>E-Mail</th><td><input required name="email" type="email"></td><th>Bundesland</th><td><input name="state"></td></tr><tr><th>Telefon</th><td><input required name="phone" type="tel"></td><th>Land</th><td><select name="country"><option>Deutschland<option>&Ouml;sterreich<option>Schweiz</select></td></tr><tr><th>Bevorzugte Kontaktmethode</th><td><select name="contact_method"><option value="phone">Telefon<option value="mail">E-Mail</select></td><th>Nationalit&auml;t</th><td><input name="nationality"><br><i>Diese Angabe ist wegen der unterschiedlichen<br>Einreisebestimmungen wichtig.</i></td></tr></tbody><tfoot><tr><td colspan="4">Bitte f&uuml;llen Sie alle mit <span class="required">*</span> markierten Felder aus.<br>Ihre Daten werden selbstverst&auml;ndlich vertraulich behandelt und unter keinen Umst&auml;nden weitergegeben.</td></tr><tr><td colspan="4"><input type="checkbox" name="newsletter" checked tabindex="4" id="cb_newsletter"><label for="cb_newsletter">Ja, ich m&ouml;chte den Studium-Ausland-Newsletter per E-Mail erhalten.</label></td></tr>'+(fbk.noAutoQ?"":'<tr><td colspan="4">Bitte beachten Sie, dass diese Anfrage v&ouml;llig unverbindlich ist. Wenn Sie dieses Formular abschicken, schicken wir Ihnen unverz&uuml;glich eine E-Mail mit Ihrem Kostenvoranschlag. Sie k&ouml;nnen dann in aller Ruhe abw&auml;gen und melden sich wieder bei uns, sobald Sie sich entschieden haben.</td></tr>')+"</tfoot></table></div>");y=x.elem.find("#stage-3 tbody");y.find("input[required]").parent().prev().prepend('<span class="required">* </span>');y.find("td:nth-child(2) :input").attr("tabindex",2);y.find("td:nth-child(4) :input").attr("tabindex",3)}x.elem.children("h2,nav").remove();x.elem.prepend("<h2>Kostenvoranschlag &ndash; Wie erreichen wir Sie?</h2>").append('<nav><input type="button" id="rq-back" value="&laquo; Zur&uuml;ck" tabindex="6"><input type="submit" id="rq-next" value="'+(fbk.noAutoQ?"Weiter &raquo;":"Absenden")+'" tabindex="5"></nav>');x.elem.find("#stage-3 :input").prop("disabled",false);break;case 13:z=h(z);z.filter("section.quote").children("header").addClass("open").end().insertAfter("section.quote:last");try{var l=Ajax.cache[0].page[("quote" in Ajax.cache[0].page)?"quote":"quote?u="+x.u+"&q="+x.q];l[1]=l[1].add(z.filter("section.quote"))}catch(r){}z=z.filter("quote"==Ajax.state.id&&"page"==Ajax.state.object?"#at-quote":"#not-at-quote");case 4:if(fbk.noAutoQ){if(!x.elem.find("#stage-4").length){x.elem.append('<div><table id="stage-4"><tbody><tr><th>Geburtsdatum</th><td><input name="birthdate"></td></tr><tr><th>Beruf</th><td><input name="job"></td></tr><tr><th>Sprachkenntnisse</th><td><select name="lang_level"><option value="0">Keine Vorkenntnisse<option value="1">Grundkenntnisse<option value="2">Untere Mittelstufe<option value="3">Mittelstufe<option value="4">Obere Mittelstufe<option value="5">Fortgeschrittene</select></td></tr><tr><th>Bisherige Lernerfahrungen</th><td><textarea name="experience"></textarea></td></tr><tr><th>Sonstiges, Bemerkungen</th><td><textarea name="comments"></textarea></th></tr></tbody><tfoot><tr><td colspan="4">Bitte beachten Sie, dass diese Anfrage v&ouml;llig unverbindlich ist. Wenn Sie dieses Formular abschicken, schicken wir Ihnen unverz&uuml;glich eine E-Mail mit Ihrem Kostenvoranschlag. Sie k&ouml;nnen dann in aller Ruhe abw&auml;gen und melden sich wieder bei uns, sobald Sie sich entschieden haben.</td></tr></tfoot></table></div>')}x.elem.children("h2,nav").remove();x.elem.prepend("<h2>Mit den folgenden Angaben erleichtern Sie uns die Arbeit:</h2>").append('<nav><input type="button" id="rq-back" value="&laquo; Zur&uuml;ck" tabindex="6"><input type="submit" id="rq-next" value="Absenden" tabindex="5"></nav>');x.elem.find("#stage-4 :input").prop("disabled",false);break}case 5:x.elem.empty().append("<h2>Vielen Dank!</h2>").append(z);if(!x.elem.find("a").length){setTimeout(x.setStage,4000,(4==n||5==n)?0:10)}break}x.stage=n;x.elem.addClass("stage-"+n);if(y&&x.data){for(p in x.data){m=y.find('[name="'+p+'"]');if(m.is('[type="checkbox"]')){if(/\[]/.test(p)){for(o in x.data[p]){m.filter('[value="'+o+'"]').prop("checked",x.data[p][o])}}else{m.prop("checked",x.data[p])}}else{m.val(x.data[p])}}}x.position(true);u.change()},position:function(j){if(!this.stage){return this.elem.add("#rq-ph").detach()}this.elem.removeClass("fixed static");if(j||!this.height){this.elem.css({top:0,left:0,width:"",maxWidth:((1==this.stage||10==this.stage)?h("#content").width():h("#page>.w1k").width()-20)+"px",position:"fixed"}).appendTo(document.body);this.height=this.elem.innerHeight()+parseInt((this.elem.css("border-top-width").match(/\d+/)||"0")[0]);this.outerHeight=this.elem.outerHeight(true)}var o=h(window),m=o.height()-this.height,n,l,k;if(1==this.stage||10==this.stage){n=h("#rq-ph");if(!n.length){n=h('<div id="rq-ph" />').appendTo("#content")}n.height(this.outerHeight);l=n.offset();if(m+o.scrollTop()>l.top){return this.elem.addClass("static").css({position:"static"}).appendTo(n)}else{k={position:"fixed",top:m+"px"};this.elem.addClass("fixed")}k.left=(l.left+n.width()-this.elem.css("position","fixed").outerWidth())+"px"}else{n=h("#page>.w1k");k={top:m+"px",position:"fixed",left:n.offset().left+10+"px",width:n.width()-20+"px"};this.elem.addClass("fixed")}for(i in k){if(this.elem.css(i)!=k[i]){this.elem.css(i,k[i])}}this.elem.appendTo(document.body)},resetData:function(){if(this.data){delete this.data.course;delete this.data.acc;delete this.data.room;delete this.data.board;delete this.data["fees[]"]}(this.data||(this.data={})).school=MemBox.current}}})(jQuery);